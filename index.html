<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M4 Metro Pub </title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        :root { --m4-blue: #0054a6; --beer-gold: #ffb400; --bg-dark: #020205; }
        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Poppins', sans-serif; background-color: var(--bg-dark);
            color: white; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 20px;
            overflow-x: hidden;
        }

        /* 5. MADDE: HAREKETLÄ° METRO ANÄ°MASYONU */
        .metro-track { position: fixed; bottom: 50px; left: -100%; width: 300px; height: 40px; background: #333; border-radius: 5px; opacity: 0.3; z-index: -1; animation: metroRun 15s linear infinite; display: flex; align-items: center; justify-content: space-around; }
        .metro-track::before { content: 'M4'; color: white; font-weight: bold; font-size: 1.2rem; }
        @keyframes metroRun { 0% { left: -100%; } 100% { left: 200%; } }

        .m4-logo { background: var(--m4-blue); font-family: 'Bebas Neue'; font-size: 3.2rem; padding: 5px 35px; border-radius: 5px; display: inline-block; box-shadow: 0 0 25px rgba(0, 84, 166, 0.4); border: 2px solid white; letter-spacing: 3px; margin-bottom: 25px; }
        
        .card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); padding: 20px; border-radius: 25px; border: 1px solid rgba(255, 255, 255, 0.1); max-width: 480px; width: 100%; box-shadow: 0 20px 50px rgba(0,0,0,0.5); text-align: center; margin-bottom: 20px; }
        
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; max-width: 480px; }
        .tab-btn { flex: 1; padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white; cursor: pointer; font-family: 'Bebas Neue'; font-size: 1.2rem; }
        .tab-btn.active { background: var(--m4-blue); }

        /* 2. MADDE: PROFÄ°L RENKLERÄ° */
        .msg { padding: 12px; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid var(--m4-blue); text-align: left; background: rgba(255,255,255,0.03); }
        .user-tag { font-weight: bold; font-size: 0.8rem; padding: 2px 8px; border-radius: 5px; margin-right: 5px; }

        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; border: 1px solid #333; background: rgba(0,0,0,0.4); color: white; outline: none; }
        button { width: 100%; padding: 15px; border-radius: 50px; border: none; background: linear-gradient(135deg, var(--beer-gold), #e67e22); font-weight: 900; cursor: pointer; color: black; }
        .hidden { display: none !important; }
        .total-box { font-size: 5rem; font-weight: 800; color: var(--beer-gold); margin: 5px 0; }
        footer { margin-top: auto; padding: 20px; font-size: 0.7rem; opacity: 0.5; font-style: italic; }
    </style>
</head>
<body>

    <div class="metro-track"></div>
    <div class="m4-logo">M4 METRO</div>

    <div id="auth-ui" class="card">
        <h3>Ä°STASYON GÄ°RÄ°ÅÄ°</h3>
        <input type="text" id="nick" placeholder="Rumuz">
        <input type="password" id="pass" placeholder="Åifre">
        <select id="pColor">
            <option value="#ffb400">AltÄ±n SarÄ±sÄ±</option>
            <option value="#00f2ff">Neon Mavi</option>
            <option value="#ff00ff">M4 Pembe</option>
            <option value="#00ff00">Ray YeÅŸili</option>
        </select>
        <button onclick="handleAuth()">MEKANA GÄ°R</button>
    </div>

    <div id="main-ui" class="hidden" style="width: 100%; max-width: 480px;">
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('pub')">PUB</button>
            <button class="tab-btn" onclick="showTab('games')">OYUN SALONU</button>
        </div>

        <div id="tab-pub">
            <div class="card">
                <span id="welcome-text"></span>
                <div class="total-box" id="total">0</div>
                <button onclick="doCheers()">ÅEREFE! ğŸ»</button>
                <small onclick="logout()" style="display:block; margin-top:10px; cursor:pointer; color:red; text-decoration:underline;">Ã‡Ä±kÄ±ÅŸ Yap</small>
            </div>
            <div class="card">
                <h3 style="font-family:'Bebas Neue';">ğŸ† SIRALAMA</h3>
                <div id="leader-list"></div>
            </div>
            <div class="card">
                <h3 style="font-family:'Bebas Neue';">ğŸ“¢ DUVAR</h3>
                <textarea id="msgIn" rows="2" placeholder="MesajÄ±nÄ± as..."></textarea>
                <button onclick="send()" style="background:var(--m4-blue); color:white; padding:10px;">GÃ–NDER</button>
                <div id="msg-list" style="margin-top:15px; max-height:200px; overflow-y:auto;"></div>
            </div>
        </div>

        <div id="tab-games" class="hidden">
            <div class="card">
                <h3>ğŸ² BÄ°RASINA ZAR</h3>
                <p>Zar at, ÅŸansÄ±nÄ± dene!</p>
                <div id="dice-result" style="font-size: 3rem; margin: 20px;">ğŸ²</div>
                <button onclick="rollDice()">ZAR AT</button>
            </div>
            <div class="card">
                <h3>ğŸª™ YAZI - TURA</h3>
                <div id="coin-result" style="font-size: 2rem; margin: 20px;">ğŸª™</div>
                <button onclick="flipCoin()">PARAYI FIRLAT</button>
            </div>
        </div>
    </div>

    <footer>poyraz tarafÄ±ndan alkol ile oluÅŸturuldu</footer>

    <script>
        const config = { databaseURL: "https://m4-metro-biramatik-default-rtdb.europe-west1.firebasedatabase.app/" };
        firebase.initializeApp(config);
        const db = firebase.database();

        let user = localStorage.getItem('m4_user');
        let userColor = localStorage.getItem('m4_color') || '#ffb400';
        if(user) showMain();

        function handleAuth() {
            const n = document.getElementById('nick').value.trim();
            const p = document.getElementById('pass').value.trim();
            const c = document.getElementById('pColor').value;
            if(!n || !p) return alert("Eksik bilgi!");
            db.ref('users/' + n).once('value', s => {
                const d = s.val();
                if(!d) db.ref('users/' + n).set({ p: p, c: c }).then(() => login(n, c));
                else if(d.p === p) login(n, d.c || c);
                else alert("Åifre yanlÄ±ÅŸ!");
            });
        }

        function login(n, c) { 
            localStorage.setItem('m4_user', n); 
            localStorage.setItem('m4_color', c);
            user = n; userColor = c; showMain(); 
        }

        function showTab(type) {
            document.getElementById('tab-pub').classList.toggle('hidden', type !== 'pub');
            document.getElementById('tab-games').classList.toggle('hidden', type !== 'games');
            document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.toggle('active', (i === 0 && type === 'pub') || (i === 1 && type === 'games')));
        }

        function showMain() {
            document.getElementById('auth-ui').classList.add('hidden');
            document.getElementById('main-ui').classList.remove('hidden');
            document.getElementById('welcome-text').innerText = "Vatman: " + user;
        }

        function doCheers() {
            db.ref('total').transaction(x => (x || 0) + 1);
            db.ref('leader/' + user).transaction(x => (x || 0) + 1);
        }

        function rollDice() {
            const r = Math.floor(Math.random() * 6) + 1;
            document.getElementById('dice-result').innerText = ['âš€','âš','âš‚','âšƒ','âš„','âš…'][r-1];
        }

        function flipCoin() {
            const r = Math.random() < 0.5 ? 'YAZI' : 'TURA';
            document.getElementById('coin-result').innerText = r;
        }

        function send() {
            const t = document.getElementById('msgIn').value;
            if(!t) return;
            db.ref('posts').push({ u: user, t: t, c: userColor, time: new Date().toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'}) });
            document.getElementById('msgIn').value = '';
        }

        db.ref('total').on('value', s => document.getElementById('total').innerText = s.val() || 0);
        db.ref('leader').on('value', s => {
            const sorted = Object.entries(s.val() || {}).sort((a,b) => b[1]-a[1]).slice(0,5);
            document.getElementById('leader-list').innerHTML = sorted.map(([n, v], i) => `<div style="display:flex; justify-content:space-between; padding:5px; font-size:0.9rem;"><span>#${i+1} ${n}</span><b>${v}</b></div>`).join('');
        });
        db.ref('posts').limitToLast(10).on('value', s => {
            const list = document.getElementById('msg-list'); list.innerHTML = '';
            const data = s.val() || {};
            Object.keys(data).reverse().forEach(id => {
                const m = data[id];
                list.innerHTML += `<div class="msg"><span class="user-tag" style="background:${m.c || '#444'}">@${m.u}</span><small>${m.time}</small><br>${m.t}</div>`;
            });
        });
        function logout() { localStorage.clear(); location.reload(); }
    </script>
</body>
</html>
